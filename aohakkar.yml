# Avatar of Hakkar is a boss fight.
# Tyler J. Sawyer
# Based loosely on : http://scripts.citizensnpcs.co/view/34aapf

# AOH
# on attack
# flag player inBossFight:true
# on player death:
# if flag player inboosfight == true
# retain player inventory

# AOH Fight
# Phase 1:
# 100 - 50%
# Knock back : 10 block teleport in air random player on hate list
# 30 sec cooldown
# Summon 2 zombie adds one of four corner locations randomly
# 30 sec cooldown
# Spalsh potion of poison on boss every 20 sec
# do splash potion effect on boss

# Phase 2:
# 49 - 0%
# All of phase 1 abilities
# Sacrifice:
#  TP random palyer to alter
# Poison and blind the player
# 30 sec cooldown

# Respawn Timer : 43200 seconds - 12 hours

aohakkar:
  type: assignment

  default constants:
    # Agro Message : Message to display when a player engages the boss.
    agro message: <red>YOU CANNOT STOP THE POWER OF HAKKAR!
    # Death Message : Message displayed when the boss is slain.
    death message: <red>YOU HAVE NOT SEEN THE LAST OF HAKKAR!
    # Victory Message : Message when a player is killed by the boss.
    victory message: <red>AAHH..ANOTHER SACRIFICE FOR HAKKAR!
    # Random Message 1-3 : Random flavor text.
    random message1: <red>-HISSSSS-
    random message2: <red>MADNESS WILL CONSUME YOU!
    random message3: <red>DEATH TO ALL WHO OPPOSE HAKKAR!

    # Avatar of Hakkar : Statistics
    # Avatar of Hakkar Health Pool
    aoh_health: 2000
    # Avatar of Hakkar Damage / Swing
    aoh_str: 5
    # Avatar of Hakkar Armor Value
    aoh_AC: 1
    # Avatar of Hakkar Agro Radius (in Blocks)
    aoh_AGRO_RADIUS: 15
    # Avatar of Hakkar Movement Speed (Blocks / Tick)
    aoh_Movement_Speed: 2
    # Avatar of Hakkar's Spawnpoint
    aoh_SpawnPoint: "23,69,536,world"
    # Avatar of Hakkar Respawn Timer in seconds (43200 = 12 hrs)
    aoh_Respawn_Timer: 10
    # Avatar of Hakkar XP Amount he drops on death
    aoh_XP_AMT: 2500

    # Avatar of Hakkar : Adds
    # Avatar of Hakkar Add Spawn Point Sphere
    aoh_add_cuboid_1: "30,69,527,world"
    aoh_add_cuboid_2: "14,69,537,world"

  interact scripts:
  - 10 AOHakkarScript

  actions:
    on assignment:
    - trigger name:proximity toggle:true "radius:<cons:aoh_AGRO_RADIUS>"
    - trigger name:damage toggle:true

    # Avatar of Hakkar Cuboid for Add Spawns.
    - flag npc "cuboid:cu@<cons:aoh_add_cuboid_1>|<cons:aoh_add_cuboid_2>"

    # Setup Avatar of Hakkar stats.
    - execute as_server "npc sel <npc.id>"
    - execute as_server "npc type player"
    - execute as_server "npc speed <cons:aoh_Movement_Speed>"
    - execute as_server "npc lookclose"
    - execute as_server "trait sentry"
    - execute as_server "sentry health <cons:aoh_health>"
    - execute as_server "sentry respawn <cons:aoh_Respawn_Timer>"
    - execute as_server "sentry speed <cons:aoh_Movement_Speed>"
    - execute as_server "sentry strength <cons:aoh_str>"
    - execute as_server "sentry armor <cons:aoh_AC>"
    - execute as_server "sentry range <cons:aoh_AGRO_RADIUS>"

    on spawn:
    # Warp Avatar of Hakkar to its spawn point on spawn.
    - teleport <npc> "location:<cons:aoh_SpawnPoint>"
    # Clear previous targets from hate list
    - execute as_server "npc sel <npc.id>"
    - execute as_server "sentry target clear"
    - execute as_server "sentry target add entity:player"
    # Clear boss flags
    - flag npc BossPlayerList:!

    on death:
    # XP amount
    - drop XP qty:<cons:aoh_XP_AMT> location:<npc.location>
    # Reset npc effects and clear hate targets.
    - execute as_server "npc sel <npc.id>"
    - execute as_server "npc effect --play none"
    - execute as_server "sentry target clear"
    # Announce to players the boss is dead.
    - announce "<red><npc.name> yells, <cons:death message>"
    - announce "<&5><npc.name> has been slain!"

    on damage:
    # IF the boss is hit by a player, refresh the engaged flag.
    - if <context.damager.is_player> flag player "AvatarOfHakkar_Engaged:true" duration:30

    on enter proximity:
    - announce "<red><npc.name> yells<&cm> <&sq><cons:agro message><&sq>"
    - playsound location:<npc.location> sound:cat_hiss
    # Flag the player as 'engaged' with the boss for 30 seconds.
    # If the player attacks the NPC, this refreshes.
    # If the player gets summoned, this refreshes.
    # If the player warps to spawn or home, this duration will fade out.
    - flag player "AvatarOfHakkar_Engaged:true" duration:30

    on exit proximity:
    # summon player if they are still engaged by the boss.
    - if "<flag.p:AvatarOfHakkar_Engaged:true || false>" == true {
      - announce "<red><npc.name> yells<&cm> <&sq>You will not evade me<&cm> <player.name>!<&sq>"
      - narrate "<yellow>You have been summoned!"
      - teleport <player> "location:<npc.location>"
      - playsound location:<player.location> sound:portal_travel
      - playeffect location:<player.location> effect:portal qty:1000
      }

"AOHakkarScript":
   type: interact
   steps:
     1:
       click trigger:
         script:
         # Right Clicking on the boss tells you his % health.
         - narrate "<yellow>Avatar of Hakkar<&co> <npc.health.percentage.as_int>%"
       proximity trigger:
         entry:
           script:
           # Add player to the boss list when they enter his proximity.
           - if <npc.flag[BossPlayerList].aslist> !contains <player> && <player.name> != <npc.name> flag npc BossPlayerList:->:<player>
           