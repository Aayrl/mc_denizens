# Plane of Ender - Attunement Questline
# Tyler J. Sawyer
# 4-8-14

# Base Quest Assignment for 'Aayrl' NPC.
# Hands out the various steps.
"poEnderAttunement":
    type: assignment
    
    interact scripts:
    - 5 LoreStep
    - 10 GatherSupplies
    #- 20 CraftingSupplies
    #- 30 KillingForJustice
    #- 40 Diplomacy
    #- 50 AvatarMustDie
    #- 60 FlaggingForPOEnder

# LORE STEP : PRE-ATTUNEMENT QUEST.
"LoreStep":
    type: interact
    steps:
        'StartAttunePOEnd*':
            click trigger:
                script:
                - chat 'Hail there, <player.name> Welcome to my kingdom! Are you looking for an <&lb><red>Epic Adventure<green><&rb>?'
            chat trigger:
                'continuePOEnd1':
                    trigger: 'What /epic adventure/?'
                    script: 
                    - chat 'I am assembling a small hunting force to venture forth into a twisted place known as the <&5>Plane of Ender<green>. Perhaps you have heard of it, <player.name>. Do you think you are up to the <&lb><red>challenge<green><&rb>?'
                    - zap 'step:StartAttunePOEnd2'
        'StartAttunePOEnd2':
            click trigger:
                script:
                - chat 'I am assembling a small hunting force to venture forth into a twisted place known as the <&5>Plane of Ender<green>. Perhaps you have heard of it, <player.name>. Do you think you are up to the <&lb><red>challenge<green><&rb>?'
            chat trigger:
                'continuePOEnd2':
                    trigger: 'What /challenge/?'
                    script:
                    - chat 'Ahh. You are very brave<&cm> <player.name>. I would welcome you to join our hunting party<&cm> but you must first <&lb><red>prove<green><&rb> yourself to my kingdom!'
                    - zap 'step:StartAttunePOEnd3'
        'StartAttunePOEnd3':
            click trigger:
                script:
                - chat 'Ahh. You are very brave<&cm> <player.name>. I would welcome you to join our hunting party<&cm> but you must first <&lb><red>prove<green><&rb> yourself to my kingdom!'
            chat trigger:
                'continuePOEnd2':
                    trigger: 'I am willing to /prove/ myself.'
                    script:
                    - chat 'I am glad to hear you are excited to help<&cm> <player.name>. Your first task shall be to help us <&lb><red>gather<green><&rb> some supplies.'
                    - flag player "POEnderAttune:Step1"

# STAGE 1 OF ATTUNEMENT : GATHERING SUPPLIES
# GATHER 64 Cobblestone, 20 Coal
# Deliver to Karol and then speak to Aayrl.
# Upon complete:
#	- announce "<aqua><player.name> has completed step 1 of 5 of the <maroon>Attunement to Enderland<aqua> questline!"
"GatherSupplies":
    type: interact
    requirements:
      mode: ALL
      list: 
      - FLAGGED 'POEnderAttune:Step1'
    steps:
        'poend_gather1*':
            click trigger:
                script:
                - chat 'I am glad to hear you are excited to help<&cm> <player.name>. Your first task shall be to help us <&lb><red>gather<green><&rb> some supplies.'

            chat trigger:
                'gather1cont':
                    trigger: 'What do you need me to /gather/?'
                    script: 
                    - chat 'Start by gathering 64 Cobblestone and deliver them to me.'
                    - listen block type:collect block:4 qty:1 script:PoEnder_CobbleProg 
                    - flag player PoEnder_Cobble:0
                    - narrate '<yellow>You have accepted the task "POE<&co> Gathering Supplies".'
                    - zap 'step:poend_gather2'
        'poend_gather2':
            click trigger:
                script:
                - chat "You still need to gather more Cobblestone<&cm> <player.name> Speak to me when you have 64."
                - narrate '<yellow>Progress<&co> <player.flag[PoEnder_Cobble].asint> / 64 Cobblestone Gathered.'

        # If the player has been flagged as 'complete', launch this process.
        'poend_gather3':
            click trigger:
                script:
                    - chat "Ah<&cm> I see you have returned<&cm> <player.name>. Do you have the 64 Cobblestone? Let me see."
                    - take 'item:4' qty:64
                    - wait 1
                    - chat "Excellent<&cm> <player.name>. Next, I require 20 Coal. Return to me when you have fetched 20 Coal."
                    - listen block type:collect block:coal qty:1 script:PoEnder_CoalProg 
                    - flag player PoEnder_Coal:0
                    - zap 'step:poend_gather4'

        'poend_gather4':
            click trigger:
                script:
                - chat "You still need to gather more Coal<&cm> <player.name> Speak to me when you have 20."
                - narrate '<yellow>Progress<&co> <player.flag[PoEnder_Coal].asint> / 20 Coal Gathered.'

        # If the player has been flagged as 'complete', launch this process.
        'poend_gather5':
            click trigger:
                script:
                    - chat "Ah<&cm> I see you have returned<&cm> <player.name>. Do you have the 20 Coal? Let me see."
                    - take 'item:coal' qty:20
                    - wait 1
                    - chat "Good Work<&cm> <player.name>. It seems you are ready for my next task."    
                    - flag player "POEnderAttune:Step2"
                    - announce "<aqua><player.name> has completed step 1 of 5 of the <&5>Attunement to Enderland<aqua> questline!"


PoEnder_CobbleProg:
    type: task
    script:
    - flag player PoEnder_Cobble:++
    - narrate "<yellow>Cobblestone Gathered<&co> <player.flag[PoEnder_Cobble].asint>/64"
    - if <player.flag[PoEnder_Cobble].asint> >= 64 run PoEnder_CobbleDone
      else run PoEnder_CobbleContinue

PoEnder_CobbleContinue:
    type: task
    script:
    - listen block type:collect block:4 qty:1 script:PoEnder_CobbleProg 

PoEnder_CobbleDone:
    type: task
    script:
    - narrate "<yellow>You have gathered <player.flag[PoEnder_Cobble].asint>/64 Cobblestone! Speak to <npc.name> for further instructions!"
    - zap 'step:poend_gather3' script:GatherSupplies

PoEnder_CoalProg:
    type: task
    script:
    - flag player PoEnder_Coal:++
    - narrate "<yellow>Coal Gathered<&co> <player.flag[PoEnder_Coal].asint>/64"
    - if <player.flag[PoEnder_Coal].asint> >= 20 run PoEnder_CoalDone
      else run PoEnder_CoalContinue

PoEnder_CoalContinue:
    type: task
    script:
    - listen block type:collect block:coal qty:1 script:PoEnder_CoalProg 

PoEnder_CoalDone:
    type: task
    script:
    - narrate "<yellow>You have gathered <player.flag[PoEnder_Coal].asint>/20 Coal! Speak to <npc.name> for further instructions!"
    - zap 'step:poend_gather5' script:GatherSupplies
# STAGE 2 OF ATTUNEMENT : CRAFTING SUPPLIES
# Create 4x Iron Sword
# Create 1x Iron Helm
# Create 1x Iron Chestplate
# Create 1x Iron Leggings
# Create 1x Iron Boots
# Deliver these to the Blacksmith, then speak to Aayrl.
# Upon complete:
#	- announce "<aqua><player.name> has completed step 2 of 5 of the <maroon>Attunement to Enderland<aqua> questline!"



# STAGE 3 OF ATTUNEMENT : KILLING THINGS
# Kill 10 skeletons, 10 spiders, 10 zombies, 5 creepers.
# Then, speak to Aayrl.
# Upon complete:
#	- announce "<aqua><player.name> has completed step 3 of 5 of the <maroon>Attunement to Enderland<aqua> questline!"


# STAGE 4 OF ATTUNEMENT : DIPLOMACY
# Speak to the Kelethin Overlord. They will demand 25 Gold Bars for their support.
# Speak to Jennavb13 in Thurgadin. She will demand 10 Quartz Blocks for their support.
# Then, speak to Aayrl.
# Upon complete:
#	- announce "<aqua><player.name> has completed step 4 of 5 of the <maroon>Attunement to Enderland<aqua> questline!"			


# STAGE 5 (FINAL) OF ATTUNEMENT : AVATAR OF HAKKAR
# Bring a small raid force (or solo) the Avatar of Hakkar.
# Return his head as proof of the deed to Aayrl.


# STAGE 6 : FLAGGING!
# Quest wrap-up, this is where you character gets flagged to enter POEnder.
# Upon complete:
#	- announce "<red>Aayrl yells, 'Let it be known that on this day, <aqua><player.name><red> has defeated the Avatar of Hakkar, and as such, earned the highest rank of the Gondorian Guard!'"
#	- announce "<red>Aayrl yells, 'Let their name ring thoughout the lands! All hail <aqua>General <player.name><red>!'"
#	- announce "<aqua><player.name> has completed the final step of the <maroon>Attunement to Enderland<aqua> questline!"
#	- announce "<aqua><player.name> is now attuned for the <maroon>Plane of Ender<aqua>!"
